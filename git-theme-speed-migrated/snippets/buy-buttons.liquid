{%- comment -%}
----------------------------------------------------------------------------------------------------------------------
BUY BUTTONS
----------------------------------------------------------------------------------------------------------------------

This component is used to show the buy buttons

********************************************
Supported variables
********************************************

* product: the product from which to show the buttons
* show_payment_button: if we show or not the dynamic checkout button
* show_gift_card_recipient: for gift card products, an optional message/email to be sent to the recipient
* button_size: the size of the button (default to xl if none is passed)
* atc_button_background: the background of the ATC button
* atc_button_text_color: the text color of the ATC button
* payment_button_background: the custom dynamic checkout button background
* payment_button_text_color: the custom dynamic checkout button text color
* form_id: if specified, define the form ID linked to this input
{%- endcomment -%}

{%- assign variant_picker_block = section.blocks | where: 'type', 'variant_picker' | first -%}

{%- assign recipient_feature_active = false -%}

{%- if product.gift_card? and show_gift_card_recipient -%}
  {%- assign recipient_feature_active = true -%}
  {%- assign show_payment_button = false -%}
{%- endif -%}

{%- form 'product', product, is: 'product-form', id: form_id -%}
  <input type="hidden" {% if variant_picker_block != blank %}disabled{% endif %} name="id" value="{{ product.selected_or_first_available_variant.id }}">

  {%- assign button_disabled = false -%}
  {%- assign button_size = button_size | default: 'xl' -%}

  {%- if product.selected_or_first_available_variant == nil -%}
    {%- capture button_content -%}{{ 'product.general.unavailable_button' | t }}{%- endcapture -%}
    {%- assign button_disabled = true -%}
  {%- elsif product.selected_or_first_available_variant.available -%}
    {%- if product.template_suffix contains 'pre-order' -%}
      {%- capture button_content -%}{{ 'product.general.pre_order_button' | t }}{%- endcapture -%}
    {%- else -%}
      {%- capture button_content -%}
        {%- if product.handle contains 'headphone-connect' -%} 
          GET YOUR ACCESS PASS
        {%- elsif product.vendor contains 'Experiences' -%}
          SIGN UP NOW  
        {%- elsif product.tags contains 'home-audition' -%}
          TRY IT NOW
        {%- elsif product.template_suffix == 'club-audiophile-moonshine' -%} 
          GET YOUR ACCESS PASS
        {%- elsif product.tags contains 'Pre-Order' -%}
          PRE-ORDER
        {%- else -%}
          {{ 'product.general.add_to_cart_button' | t }}
        {%- endif -%}
      {%- endcapture -%}
    {%- endif -%}
  {%- else -%}
    {%- if product.tags contains 'lala' -%}
      {%- capture button_content -%}GOING ON SALE SOON{%- endcapture -%}
      {%- assign button_disabled = true -%}
    {%- else -%}
      {%- if product.handle contains 'lala' -%}
        {%- capture button_content -%}COMING SOON{%- endcapture -%}
        {%- assign button_disabled = true -%}
      {%- else -%}
        {%- if product.tags contains 'Coming-soon' -%}
          {%- capture button_content -%}COMING SOON{%- endcapture -%}
          {%- assign button_disabled = true -%}
          <script>
            document.addEventListener('variant:change', function(event) {
              let variant = event.detail.variant;
              let product = event.detail.product;
              let form = event.target;
              {document.querySelector(".button div").innerHTML="COMING SOON";}
            });
          </script>

        {%- else -%}
          {%- if product.tags contains 'museum' -%}
            {%- capture button_content -%}GONE FOREVER ðŸ‘»{%- endcapture -%}
            {%- assign button_disabled = true -%}

          {%- else -%}
            {%- capture button_content -%}{{ 'product.general.sold_out_button' | t }}{%- endcapture -%}
            {%- assign button_disabled = true -%}
          {%- endif -%}
        {%- endif -%}
      {%- endif -%}
    {%- endif -%}
    {% if product.metafields.hpz.expected_to_restocked != blank %}
      <p style="text-align: center; font-size: 14px; margin-bottom: 30px; margin-top: 20px;letter-spacing:2px;text-transform:uppercase;font-weight:bold;">
        Expected to be restocked by <b style="color:#ED473F;">{{ product.metafields.hpz.expected_to_restocked.value }}</b>
      </p>
    {%- endif -%}

    {% if product.metafields.hpz.launch_date != blank %}
      <p style="text-align: center; font-size: 14px; margin-bottom: 30px; margin-top: 20px;letter-spacing:2px;text-transform:uppercase;font-weight:bold;">
        Launching on <b style="color:#ED473F;">{{ product.metafields.hpz.launch_date.value }}</b>
      </p>
    {%- endif -%}
    
    {% if product.metafields.hpz.coming_soon_by != blank %}
      <p style="text-align: center; font-size: 14px; margin-bottom: 30px; margin-top: 20px;letter-spacing:2px;text-transform:uppercase;font-weight:bold;">
        Coming soon by <b style="color:#ED473F;">{{ product.metafields.hpz.coming_soon_by.value }}</b>
      </p>
    {%- endif -%}
  {%- endif -%}

  <div class="v-stack gap-4">
    {%- if recipient_feature_active -%}
      <gift-card-recipient class="gift-card-recipient v-stack gap-3">
        {%- assign checkbox_label = 'gift_card.recipient.checkbox' | t -%}
        {%- render 'checkbox', label: checkbox_label, name: 'properties[__shopify_send_gift_card_to_recipient]' -%}

        <div class="gift-card-recipient__fields" hidden>
          <div class="fieldset">
            {%- liquid
              assign recipient_email_label = 'gift_card.recipient.email_label' | t
              render 'input', type: 'email', label: recipient_email_label, name: 'properties[Recipient email]', value: form.email, required: true, maxlength: 138

              assign recipient_name_label = 'gift_card.recipient.name_label' | t
              render 'input', label: recipient_name_label, name: 'properties[Recipient name]', value: form.name

              assign send_on_label = 'gift_card.recipient.send_on_label' | t
              render 'input', type: 'date', label: send_on_label, name: 'properties[Send on]', value: form.send_on, pattern: '\d{4}-\d{2}-\d{2}'
              render 'input', type: 'hidden', name: 'properties[__shopify_offset]'

              assign message_label = 'gift_card.recipient.message_label' | t
              render 'input', label: message_label, name: 'properties[Message]', value: form.message, multiline: 3, maxlength: 200, show_max_characters_count: true
            -%}
          </div>
        </div>
      </gift-card-recipient>
    {%- endif -%}

    <buy-buttons class="buy-buttons {% if show_payment_button %}buy-buttons--multiple{% endif %}" template="{{ product.template_suffix | escape }}" form="{{ form_id }}">
      {%- render 'button', content: button_content, type: 'submit', size: button_size, disabled: button_disabled, secondary: show_payment_button, subdued: button_disabled, background: atc_button_background, text_color: atc_button_text_color -%}

      {%- if show_payment_button -%}
        {{- form | payment_button -}}

        <style>
          #{{ form_id }} .shopify-payment-button {
            {%- unless product.selected_or_first_available_variant.available -%}
              display: none;
            {%- endunless -%}

            {%- if payment_button_background != blank and payment_button_background != 'rgba(0,0,0,0)' -%}
              --button-background: {{ payment_button_background.rgb }};
            {%- endif -%}

            {%- if payment_button_text_color != blank and payment_button_text_color != 'rgba(0,0,0,0)' -%}
              --button-text-color: {{ payment_button_text_color.rgb }};
            {%- endif -%}
          }
        </style>
      {%- endif -%}
    </buy-buttons>
  </div>
{%- endform -%}
{% if product.tags contains 'museum' %}
  <div class="new-offer-grid">
    <div class="new-offer-text">
      <div>
        This product is permanently discontinued by the manufacturer and continues to live on in
        <a href="https://www.headphonezone.in/collections/headphone-zone-museum" target="_blank" style="color:#3c07ff;">Headphone Zone's Museum</a>.<br><br> Unfortunately, even if we desire to, we won't be able to resurrect this product. The Museum is where we pay our respects to end-of-life, old, archived, but not forgotten products. This page was made with a lot of love and  will live on for posterity. What to say, we're sentimental people. ðŸ˜”
      </div>
    </div>
  </div>
{%- endif -%}