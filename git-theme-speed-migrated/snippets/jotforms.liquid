{%- comment -%}
----------------------------------------------------------------------------------------------------------------------
Jotform Component
----------------------------------------------------------------------------------------------------------------------

This component is used to render Jotforms on the Product Page

********************************************
How to make new Jotforms
********************************************
  
Here is how you create new forms on Jotform:
* You need 2 things: Jotform ID & Form Title
* There is a case statement below create a new when statement and add the 2 things that is Form ID and Title

********************************************
Example
********************************************

  {%- case jotforms -%}
    {% when 'Talk to a Guru' %}
      {% assign title = 'Talk to a Guru' %}
      {% assign form_id = '211573371287458' %}
    {% when 'Special Enquiry' %}
      {% assign title = 'Special Enquiry' %}
      {% assign form_id = '211573371287458' %}
  {% endcase %}

{%- endcomment -%}

{%- case jotforms -%}
  {% when 'special-enquiry' %}
    {% assign title = 'Submit a Enquiry' %}
    {% assign form_id = '211573371287458' %}
  {% when 'request-a-product' %}
    {% assign title = 'Request a Product' %}
    {% assign form_id = '210803499973466' %}
  {% when 'experience-now' %}
    {% assign title = 'Visit our Experience Studio' %}
    {% assign form_id = '251103219918453' %}
  {% when 'call-back-request' %}
    {% assign title = 'Call Back Request' %}
    {% assign form_id = '241980904969472' %}
  {% when 'talk-to-a-guru' %}
    {% assign title = 'Talk to a Guru' %}
    {% assign form_id = '201834565399466' %}
  {% when 'write-to-us' %}
    {% assign title = 'Write to us' %}
    {% assign form_id = '240610700563445' %}
{% endcase %}

{% assign allowed_form_ids = "240610700563445,241980904969472" | split: "," %}
{% assign current_form_id = form_id | strip %}

{% assign allowed_form_ids = "240610700563445,241980904969472" | split: "," %}
{% assign current_form_id = form_id | strip %}

{% if customer and allowed_form_ids contains current_form_id %}
  <iframe 
    id="JotFormIFrame-{{ current_form_id }}" 
    title="{{ title }}" 
    allowtransparency="true" 
    allowfullscreen="true" 
    allow="geolocation; microphone; camera"
    src="https://form.jotform.com/{{ current_form_id }}?nojump
      &name3[first]={{ customer.first_name | escape }}
      &name3[last]={{ customer.last_name | escape }}
      &email={{ customer.email | url_encode }}
      {% if customer.phone or customer.default_address.phone %}
        &phone7={{ customer.phone | default: customer.default_address.phone | url_encode }}
      {% endif %}"
    frameborder="0" style="min-width: 100%; height:539px; border:none;"
    scrolling="yes">
  </iframe>
{% else %}
  <iframe 
    id="JotFormIFrame-{{ current_form_id }}" 
    title="{{ title }}" 
    allowtransparency="true" 
    allowfullscreen="true" 
    allow="geolocation; microphone; camera"
    src="https://form.jotform.com/{{ current_form_id }}?nojump" 
    frameborder="0" style="min-width: 100%; height:539px; border:none;"
    scrolling="yes">
  </iframe>
{% endif %}



<script type="text/javascript">
    var ifr = document.getElementById("JotFormIFrame-{{ form_id }}");
    if (ifr) {
      var src = ifr.src;
      var iframeParams = [];
      if (window.location.href && window.location.href.indexOf("?") > -1) {
        iframeParams = iframeParams.concat(window.location.href.substr(window.location.href.indexOf("?") + 1).split('&'));
      }
      if (src && src.indexOf("?") > -1) {
        iframeParams = iframeParams.concat(src.substr(src.indexOf("?") + 1).split("&"));
        src = src.substr(0, src.indexOf("?"))
      }
      iframeParams.push("isIframeEmbed=1");
      ifr.src = src + "?" + iframeParams.join('&');
    }
    window.handleIFrameMessage = function(e) {
      if (typeof e.data === 'object') { return; }
      var args = e.data.split(":");
      if (args.length > 2) { iframe = document.getElementById("JotFormIFrame-" + args[(args.length - 1)]); } else { iframe = document.getElementById("JotFormIFrame"); }
      if (!iframe) { return; }
      switch (args[0]) {
        case "scrollIntoView":
          iframe.scrollIntoView();
          break;
        case "setHeight":
          iframe.style.height = args[1] + "px";
          if (!isNaN(args[1]) && parseInt(iframe.style.minHeight) > parseInt(args[1])) {
            iframe.style.minHeight = args[1] + "px";
          }
          break;
        case "collapseErrorPage":
          if (iframe.clientHeight > window.innerHeight) {
            iframe.style.height = window.innerHeight + "px";
          }
          break;
        case "reloadPage":
          window.location.reload();
          break;
        case "loadScript":
          if( !window.isPermitted(e.origin, ['jotform.com', 'jotform.pro']) ) { break; }
          var src = args[1];
          if (args.length > 3) {
              src = args[1] + ':' + args[2];
          }
          var script = document.createElement('script');
          script.src = src;
          script.type = 'text/javascript';
          document.body.appendChild(script);
          break;
        case "exitFullscreen":
          if      (window.document.exitFullscreen)        window.document.exitFullscreen();
          else if (window.document.mozCancelFullScreen)   window.document.mozCancelFullScreen();
          else if (window.document.mozCancelFullscreen)   window.document.mozCancelFullScreen();
          else if (window.document.webkitExitFullscreen)  window.document.webkitExitFullscreen();
          else if (window.document.msExitFullscreen)      window.document.msExitFullscreen();
          break;
      }
      var isJotForm = (e.origin.indexOf("jotform") > -1) ? true : false;
      if(isJotForm && "contentWindow" in iframe && "postMessage" in iframe.contentWindow) {
        var urls = {"docurl":encodeURIComponent(document.URL),"referrer":encodeURIComponent(document.referrer)};
        iframe.contentWindow.postMessage(JSON.stringify({"type":"urls","value":urls}), "*");
      }
    };
    window.isPermitted = function(originUrl, whitelisted_domains) {
      var url = document.createElement('a');
      url.href = originUrl;
      var hostname = url.hostname;
      var result = false;
      if( typeof hostname !== 'undefined' ) {
        whitelisted_domains.forEach(function(element) {
            if( hostname.slice((-1 * element.length - 1)) === '.'.concat(element) ||  hostname === element ) {
                result = true;
            }
        });
        return result;
      }
    };
    if (window.addEventListener) {
      window.addEventListener("message", handleIFrameMessage, false);
    } else if (window.attachEvent) {
      window.attachEvent("onmessage", handleIFrameMessage);
    }
    </script>